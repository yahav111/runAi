# RunIsrael AI — Roadmap & UX Analysis

מסמך ניתוח מעמיק: חווית משתמש, יכולות קיימות, שיפורים מוצעים ושאלות אסטרטגיות.

---

## 1. מיפוי מצב קיים

### 1.1 פיצ'רים פונקציונליים קיימים ועובדים

| פיצ'ר | תיאור | מיקום בקוד |
|--------|--------|-------------|
| **צ'יפים דינמיים (Chips)** | כפתורי בחירה מהירה לפי הודעת ה-AI האחרונה. מופיעים לפי מילות מפתח (which city, elevation, water, stroller/dog, shade, distance וכו'). | `lib/get-suggestions.ts`, `components/suggestion-chips.tsx` |
| **שמירת פרופיל ב-LocalStorage** | שם + רמת ריצה (Beginner/Intermediate/Advanced) נשמרים ב-`runisrael-profile`. דיאלוג ברירת מחדל למשתמש חדש. | `lib/use-user-profile.ts`, `components/welcome-dialog.tsx` |
| **הזרמת תשובות (Streaming)** | שימוש ב-`streamText` מ-Vercel AI SDK; התשובה נשלחת כ-stream ללקוח. | `app/api/chat/route.ts` (streamText), `@ai-sdk/react` useChat |
| **זיהוי כוונה (Intent)** | Point-to-Point ("from A to B"), Loop (מרחק/זמן + מיקום), Survey (שאר המקרים). | `lib/direct-route.ts`, `app/api/chat/route.ts` |
| **כרטיסי מסלול (Route Cards)** | פרסור `<route_data>` או בלוקים עם אמוג'י; כרטיסים עם ניווט ל-Google Maps (Navigate to Start, View Full Route). | `lib/parse-routes.ts`, `components/route-card.tsx`, `route-cards-group.tsx` |
| **שלושה מצבי תכנון** | A to B, Circular Loop, Tailor-made (סקר שאלות). כרטיסי בחירה במסך הפתיחה. | `components/mode-cards.tsx`, prompts ב-`route.ts` |
| **התאמה לשעה** | בלילה (לפני 06:00 או אחרי 18:00) ה-prompt דורש מסלולים מוארים ועירוניים. | `route.ts` — `nightBlock()` |
| **התאמה לפרופיל** | שם ורמה נשלחים ל-API; ה-AI מתאים קושי ומרחק. | `route.ts` — `profileBlock()`, `body.data` |
| **Fallback פרסור** | אם אין `<route_data>`, מנסים לפרסר בלוקי אמוג'י (🏅📏🏃...) ולבנות Route עם URLs. | `lib/parse-routes.ts` — `parseRoutesFromEmojiText`, `stripEmojiRouteBlocks` |

### 1.2 ניתוח זרימת המשתמש (User Flow)

**זרימה כללית:**
1. כניסה → דיאלוג Welcome (משתמש חדש) → שמירת שם + רמה.
2. מסך פתיחה: "Ready to run?" + 3 כרטיסי מצב (A to B, Loop, Tailor-made) או הקלדה חופשית.
3. שליחת הודעה → זיהוי intent → prompt מותאם → תשובת AI (streaming).
4. אחרי תשובה: צ'יפים רלוונטיים או "Start Over"; הודעות עם Route Cards וקישורי מפות.

**חיכוך וסיכוני נטישה:**

| נקודה | סיכון | הסבר |
|--------|--------|--------|
| **זמן המתנה ל-AI** | בינוני–גבוה | אין אינדיקציה ברורה של התקדמות (מלבד "Mapping your route..."). אין timeout או retry גלוי. |
| **הקלדה רבה** | בינוני | במצב Tailor-made יש כמה שאלות ברצף; הצ'יפים מפחיתים הקלדה אבל מופיעים רק אחרי תשובת AI. |
| **צ'יפים לא רלוונטיים** | בינוני | הלוגיקה מבוססת על **מיקום מילה אחרון** (`lastIndexOf`). אם ה-AI מזכיר כמה נושאים, יוצגו צ'יפים רק לנושא האחרון — עלול לבלבל. |
| **מסלול לא מדויק** | גבוה | ה-AI לא משתמש ב-API מפות; כתובות ומסלולים עלולים להיות לא מדויקים או לא קיימים. |
| **משתמש חדש חוסם** | נמוך | דיאלוג Welcome חוסם; אם המשתמש סוגר בלי להזין שם — אין פרופיל אבל האפליקציה עובדת. |
| **שגיאות רשת/API** | בינוני | הודעת error כללית; אין הבחנה בין timeout, 500, או מפתח API חסר. |

**אינטואיטיביות:**  
בחירת מצב (כרטיסים) ו"טקסט חופשי" ברורים. הצ'יפים עוזרים אבל תלויים בניסוח ה-AI (מילות מפתח) — חוסר עקביות עלול ליצור בלבול.

---

## 2. שיפור פיצ'רים קיימים

### 2.1 צ'יפים (Chips) — חסינות לטעויות

**בעיות נוכחיות:**
- בחירה של **קבוצת צ'יפים אחת** לפי המילה האחרונה שמופיעה (`lastIndexOf`). אם ב-AI יש "city" ואז "distance", יוצגו רק צ'יפי distance.
- אין עדיפות לפי **סדר השאלות** הרצוי (למשל: קודם עיר, אחר כך מרחק).
- תלות חזקה בניסוח ה-AI: אם ה-AI לא משתמש ב-keywords מדויקים, לא יופיעו צ'יפים.

**הצעות לשיפור:**
1. **ריבוי קבוצות צ'יפים:** לאסוף את כל ה-keywords שמופיעים בהודעה ולתת צ'יפים לכל השאלות הפתוחות (למשל עיר + מרחק אם שניהם הוזכרו), עם סדר קבוע (עיר → elevation → water → וכו').
2. **מערכת עדיפויות:** להגדיר סדר לוגי לשאלות (עיר ראשון, מרחק אחרון) ולבחור צ'יפים לפי השאלה "הראשונה שעדיין לא נענתה" לפי היסטוריית הצ'יפים שנבחרו.
3. **Fallback גנרי:** אם אף keyword לא מתאים — להציג צ'יפים כלליים (ערים פופולריות או "Under 5 km" / "5–10 km") במקום להשאיר ללא צ'יפים.
4. **נורמליזציה של טקסט:** להקטין תלות בניסוח (למשל ניתוח סמנטי קל או רשימת synonyms ל-keywords).

### 2.2 דיוק ה-AI במסלולים אמיתיים בישראל

**מגבלות נוכחיות:**  
ה-AI מייצר טקסט ו-`<route_data>` ללא גישה ל-API מפות או למאגר מסלולים מאומתים. התוצאה עלולה להיות שמות מקומות או רחובות לא מדויקים.

**הצעות לשיפור:**
1. **RAG (מאגר מסלולים):** לאחסן מסלולים מאומתים (שם, התחלה, סיום, מרחק, תיאור) ולהוסיף ל-prompt קטעי context רלוונטיים לפי עיר/אזור.
2. **Geocoding בהמשך:** אחרי שה-AI מחזיר `start_point`/`end_point`, לשלוח ל-API (למשל Google Geocoding) ולוודא/לתקן כתובות ולעדכן את ה-URLs.
3. **הנחיות prompt מחמירות:** להוסיף דוגמאות של שמות רחובות/פארקים אמיתיים בערים מרכזיות ולהורות במפורש: "Use only real street names and landmarks that exist in Israel."
4. **Validation בצד שרת:** לבדוק ש-`start_point` ו-`end_point` מכילים מילות מפתח סבירות (עיר, רחוב, פארק) ולהוסיף הערה ל-AI אם הנתונים נראים לא טבעיים.

### 2.3 עקביות עיצוב (Lime & Slate)

**מצב נוכחי:**  
העיצוב משתמש ב-Tailwind עם `slate-*` לרקע/טקסט ו-`lime-*` (lime-400, lime-500) למוקדים. ב-`globals.css` מוגדרים `--primary: #84cc16`, `--ring: #84cc16` ו-`dark` על ה-root.

**בדיקה לפי קומפוננטות:**

| קומפוננטה | Lime | Slate | הערות |
|-----------|------|--------|--------|
| Header | ✅ לוגו, אייקון | ✅ רקע slate-950 | עקבי |
| Welcome / כרטיסי מצב | ✅ אייקונים, גבולות, hover | ✅ רקע, טקסט | עקבי |
| MessageBubble (user) | ✅ רקע lime-600 | — | עקבי |
| MessageBubble (assistant) | ✅ אייקון Footprints | ✅ bg-slate-800, borders | עקבי |
| RouteCard | ✅ פס עליון, Badge, כפתור View Full Route | ✅ רקע, borders | עקבי |
| SuggestionChips | ✅ default chips (lime border/bg) | ✅ reset chip (slate) | עקבי |
| ChatInput | ✅ כפתור שליחה, focus ring | ✅ input bg-slate-800 | עקבי |
| WelcomeDialog | ✅ כפתור, אייקון | ✅ דיאלוג slate-900 | עקבי |
| Badge (ב-RouteCard) | ✅ variant עם lime | — | עקבי |
| Highlights ב-RouteCard | — | — | **sky-500/sky-300** — שונה מהפלטה (Lime/Slate). אפשר לאחד ל-lime/slate. |

**סיכום:**  
העיצוב ברובו עקבי. **חריגה:** תגי Highlights ב-`route-card.tsx` משתמשים ב-`sky-500/10`, `sky-300` — אם רוצים פלטה אחידה, כדאי להחליף ל-lime/slate או לייצר משתנה עיצוב (למשל "secondary accent") ב-CSS variables.

---

## 3. הצעת פיצ'רים חדשים (ערך גבוה, מינימום זמן פיתוח)

### 3.1 כפתור שיתוף מסלול (Share Route)

**ערך:** משתמש יכול לשתף מסלול ב-WhatsApp/טלגרם/אימייל בלי להעתיק ידנית.

**יישום:**  
בכל `RouteCard` להוסיף כפתור "Share" שמייצר לינק (למשל `window.location.origin + '?route=' + encodeURIComponent(JSON.stringify(route))`) או משתמש ב-Web Share API אם זמין (`navigator.share` עם title + text + url).  
מינימום: קישור עם פרטי מסלול (שם, התחלה, סיום, קישור למפה).

### 3.2 המלצת בית קפה/טיפול קרוב לסיום (Post-run treat ליד הסיום)

**ערך:** ה-`post_run_treat` כבר קיים ב-`Route`; אפשר להדגיש אותו ויזואלית ו/או להוסיף ב-prompt הנחיה מפורשת: "Recommend a café or place to rest within 200–500m of the route end."  
שיפור קל: בפרומפט ל-AI — לבקש במפורש מקום קרוב לנקודת הסיום (ולא רק "באזור").

### 3.3 המרת יחידות מרחק (ק"מ ↔ מייל)

**ערך:** רצים שמעדיפים מיילים יראו גם את המרחק במיילים.

**יישום:**  
במודל `Route` המרחק כבר כ-string (למשל "5 km"). ב-`RouteCard` להציג את המרחק כפי שהוא, ולהוסיף מתחת או ליד המרה (למשל "5 km (≈3.1 mi)"). פונקציה פשוטה: `kmToMiles(km)`. אופציונלי: העדפת משתמש (ק"מ / מייל) ב-LocalStorage או בפרופיל.

---

### 3.4 הקלטה קולית (Voice-to-Text) לרצים בתנועה

**יתרונות:**  
פחות צורך להקליד בזמן ריצה או בהליכה; נגישות טובה יותר.

**אתגרים:**  
- דורש הרשאות מיקרופון ו-API (Web Speech API או שירות חיצוני).  
- רעש רקע ורוח משפיעים על הדיוק.  
- כפתור מיקרופון ב-UI וטיפול במצבים: הקלטה, עצירה, שליחה כטקסט.

**המלצה:**  
כפיצ'ר **אופציונלי** — כן כדאי להוסיף, במיוחד למובייל. התחלה עם Web Speech API (Speech-to-Text בדפדפן) מפחיתה תלות בשרת. אם הדיוק לא מספק, בהמשך אפשר לעבור ל-API חיצוני. מיקום: ליד שדה הקלט ב-`ChatInput` (אייקון מיקרופון).

---

## 4. שאלות אסטרטגיות (לעיצוב קוד מודולרי ועתידי)

שאלות אלו יעזרו ל-Cursor ולצוות להחליט על מבנה, הרחבה ותחזוקה:

1. **גבולות הפרויקט:**  
   האם RunIsrael AI יישאר אפליקציית Chat בלבד, או מתוכננים מסכים נוספים (מפה מוטמעת, רשימת מסלולים שמורים, היסטוריה, פרופיל מתקדם)?  
   → משפיע על פיצול routes (pages), state management, וניהול נתונים (רק localStorage מול backend).

2. **מקור האמת למסלולים:**  
   האם בעתיד תהיה מחויבות למאגר מסלולים מאומת (DB/API) או שה-AI יישאר המקור היחיד?  
   → משפיע על כך אם `parse-routes` ו-`Route` יהיו "ממשק ל-AI" בלבד או גם למאגר חיצוני.

3. **רב-לשוניות:**  
   האם מתוכננת תמיכה בעברית (UI + תשובות AI)?  
   → משפיע על i18n, על כיווניות RTL, ועל ה-prompt (כרגע "English only").

4. **ניהול state ו-API:**  
   האם יש תוכנית ל-backend (משתמשים, מסלולים שמורים, היסטוריה)?  
   → משפיע על כך אם `useUserProfile` יישאר רק localStorage או יהפוך ל-hook שמדבר עם API.

5. **טסטים ואיכות:**  
   האם יש/מתוכנן כיסוי יחידות ל-`parse-routes`, `direct-route`, ו-`get-suggestions`?  
   → חשוב ליציבות כי הלוגיקה שם קריטית ל-UX (פרסור, צ'יפים, intent).

---

## 5. סיכום תובנות

- **חוזקות:** Streaming, שלושה מצבים ברורים, צ'יפים דינמיים, שמירת פרופיל, Route Cards עם מפות, Fallback פרסור מאמוג'י.
- **חולשות:** צ'יפים תלויים ב-keyword אחד אחרון, אין מקור מסלולים מאומת, חיכוך בזמן המתנה ובהודעות שגיאה.
- **שיפורים מומלצים:** ריבוי/עדיפות צ'יפים, RAG או Geocoding לדיוק מסלולים, אחידות צבע Highlights.
- **פיצ'רים חדשים מומלצים:** שיתוף מסלול, הדגשת post-run treat ליד הסיום, המרת ק"מ↔מייל, הקלטה קולית (אופציונלי).
- **אסטרטגיה:** להחליט על גבולות מוצר, מקור מסלולים, רב-לשוניות, backend ו-tests — כדי לבנות קוד מודולרי וקל להרחבה.

---

*נוצר כחלק מניתוח UX ו-Roadmap לפרויקט RunIsrael AI.*
